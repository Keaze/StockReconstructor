package com.app.stock;

import com.app.history.model.MovementEvent;
import com.app.history.model.MovementRecord;
import com.app.stock.model.StockRecord;
import com.app.utils.Result;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertNotNull;

class StockDataBulkTest {
    private List<MovementRecord> movements;

    @BeforeEach
    void setUp() {
        movements = List.of(
                MovementRecord.builder()
                        .sequenceNumber(1710682)
                        .stockNumber(10989198)
                        .handlingUnitNumber("4000046259L")
                        .location("001PP0200000")
                        .itemNumber("102563")
                        .serialNumber(null)
                        .batch1("43974")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(0.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.DELETE)
                        .statusCode(26)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("16:24:40")
                        .user("KaMo")
                        .printIndicator("N")
                        .document1("001PP020000")
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1710681)
                        .stockNumber(10989198)
                        .handlingUnitNumber("4000046259L")
                        .location("001PP0200000")
                        .itemNumber("102563")
                        .serialNumber(null)
                        .batch1("43974")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(-2.00))
                        .quantityTotal(BigDecimal.valueOf(0.00))
                        .weightChange(BigDecimal.valueOf(-0.27))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_OUT)
                        .statusCode(26)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("16:24:40")
                        .user("KaMo")
                        .printIndicator("N")
                        .document1("001PP020000")
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1710680)
                        .stockNumber(10989198)
                        .handlingUnitNumber("4000046259L")
                        .location("001PP0200000")
                        .itemNumber("102563")
                        .serialNumber(null)
                        .batch1("43974")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(2.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("16:24:28")
                        .user("KaMo")
                        .printIndicator("N")
                        .document1("client.verpackung.umbuchung")
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1709732)
                        .stockNumber(10989198)
                        .handlingUnitNumber("4000046259L")
                        .location("001PP0100100")
                        .itemNumber("102563")
                        .serialNumber(null)
                        .batch1("43974")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(2.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("12:51:35")
                        .user("BaSi")
                        .printIndicator("N")
                        .document1("PZ0051189")
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1709731)
                        .stockNumber(10989198)
                        .handlingUnitNumber("4000046259L")
                        .location("001BC0002000")
                        .itemNumber("102563")
                        .serialNumber(null)
                        .batch1("43974")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(2.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("12:51:33")
                        .user("BaSi")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1709671)
                        .stockNumber(10989198)
                        .handlingUnitNumber("4000046259L")
                        .location("001AK0100000")
                        .itemNumber("102563")
                        .serialNumber(null)
                        .batch1("43974")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(1.00))
                        .quantityTotal(BigDecimal.valueOf(2.00))
                        .weightChange(BigDecimal.valueOf(0.27))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_IN)
                        .statusCode(25)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("11:53:33")
                        .user("KAAC")
                        .printIndicator("N")
                        .document1("ELU0001829")
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build()
        );
    }


    @Test
    void testBulk() {
        StockData stockData = new StockData(new ArrayList<>());
        movements.forEach(movement -> stockData.handleMovement(Result.success(movement)));
        assertNotNull(stockData.getStockRecord(10989198));
        assertThat(stockData.getStockRecord(10989198).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(1.00));
        assertThat(stockData.getStockRecord(10989198).getHandlingUnitNumber()).isEqualTo("4000046259L");
        assertThat(stockData.getStockRecord(10989198).getPalletNumber()).isEqualTo("4000046259L");
        assertThat(stockData.getErrors()).isEmpty();
    }

    @Test
    void testBulkGoodsReceiptMovements() {
        List<MovementRecord> movementRecords = List.of(
                MovementRecord.builder()
                        .sequenceNumber(1710364)
                        .stockNumber(9926874)
                        .handlingUnitNumber("3000026061")
                        .location("1030100207")
                        .itemNumber("100446")
                        .serialNumber(null)
                        .batch1("5A08125")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(408.00))
                        .quantityTotal(BigDecimal.valueOf(408.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_IN)
                        .statusCode(0)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("15:08:27")
                        .user("DoBe")
                        .printIndicator("N")
                        .document1("9926874")
                        .document2("3000026061")
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1710363)
                        .stockNumber(9926874)
                        .handlingUnitNumber("3000026061")
                        .location("1030100207")
                        .itemNumber("100446")
                        .serialNumber(null)
                        .batch1("5A08125")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(-408.00))
                        .quantityTotal(BigDecimal.valueOf(408.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_OUT)
                        .statusCode(0)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("15:08:27")
                        .user("DoBe")
                        .printIndicator("N")
                        .document1("9926874")
                        .document2("3000026061")
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1710356)
                        .stockNumber(9926874)
                        .handlingUnitNumber("3000026061")
                        .location("001BC0000600")
                        .itemNumber("100446")
                        .serialNumber(null)
                        .batch1("5A08125")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(408.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-19"))
                        .time("15:06:59")
                        .user("DoBe")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1679775)
                        .stockNumber(9926874)
                        .handlingUnitNumber("3000026061")
                        .location("1030100207")
                        .itemNumber("100446")
                        .serialNumber(null)
                        .batch1("5A08125")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(408.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(10)
                        .date(LocalDate.parse("2026-02-05"))
                        .time("08:50:22")
                        .user("DoBe")
                        .printIndicator("N")
                        .document1(null)
                        .document2("001WE0000000")
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1679768)
                        .stockNumber(9926874)
                        .handlingUnitNumber("3000026061")
                        .location("001BC0000600")
                        .itemNumber("100446")
                        .serialNumber(null)
                        .batch1("5A08125")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(408.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-05"))
                        .time("08:48:20")
                        .user("DoBe")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber(null)
                        .customerOrderPosition(null)
                        .build()
        );

        StockRecord stockRecord = StockRecord.builder()
                .sequenceNumber(9926874)
                .itemNumber("100446")
                .client(250)
                .batch1("5A08125")
                .batch2("____________________")
                .serialNumber(null)
                .customerOrderNumber("____________________")
                .customerOrderPosition("__________")
                .palletNumber("3000026061")
                .handlingUnitNumber("3000026061")
                .location("1031900202")
                .quantityOnHand(BigDecimal.valueOf(408.00))
                .build();

        StockData stockData = new StockData(List.of(stockRecord));
        movementRecords.forEach(movement -> stockData.handleMovement(Result.success(movement)));
        stockData.cleanUp();
        assertNotNull(stockData.getStockRecord(9926874));
        assertThat(stockData.getErrors()).isEmpty();
        assertThat(stockData.getStockRecord(9926874).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(408.00));
        assertThat(stockData.getStockRecord(9926874).getHandlingUnitNumber()).isEqualTo("3000026061");
        assertThat(stockData.getStockRecord(9926874).getPalletNumber()).isEqualTo("3000026061");
        assertThat(stockData.getStockRecord(9926874).getLocation()).isEqualTo("001BC0000600");
    }

    @Test
    void testBulkDeleteSequence() {
        List<MovementRecord> movementRecords = List.of(
                MovementRecord.builder()
                        .sequenceNumber(1704093)
                        .stockNumber(10821107)
                        .handlingUnitNumber("4000045856")
                        .location("001PP0100100")
                        .itemNumber("102494")
                        .serialNumber(null)
                        .batch1("FFQA")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(0.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.DELETE)
                        .statusCode(60)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("12:17:52")
                        .user("HS")
                        .printIndicator("N")
                        .document1("10821107")
                        .document2("4000045856")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1704092)
                        .stockNumber(10821107)
                        .handlingUnitNumber("4000045856")
                        .location("001PP0100100")
                        .itemNumber("102494")
                        .serialNumber(null)
                        .batch1("FFQA")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(-3.00))
                        .quantityTotal(BigDecimal.valueOf(0.00))
                        .weightChange(BigDecimal.valueOf(-0.99))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_OUT)
                        .statusCode(60)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("12:17:52")
                        .user("HS")
                        .printIndicator("N")
                        .document1("10821107")
                        .document2("4000045856")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1704091)
                        .stockNumber(10821107)
                        .handlingUnitNumber("4000045856")
                        .location("001PP0100100")
                        .itemNumber("102494")
                        .serialNumber(null)
                        .batch1("FFQA")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(3.00))
                        .quantityTotal(BigDecimal.valueOf(3.00))
                        .weightChange(BigDecimal.valueOf(0.99))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_IN)
                        .statusCode(60)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("12:17:52")
                        .user("HS")
                        .printIndicator("N")
                        .document1("ELU0003056")
                        .document2("2")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1704066)
                        .stockNumber(10821107)
                        .handlingUnitNumber("4000045856")
                        .location("001PP0100100")
                        .itemNumber("102494")
                        .serialNumber(null)
                        .batch1("FFQA")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(3.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("12:14:45")
                        .user("HS")
                        .printIndicator("N")
                        .document1("PZ0050974")
                        .document2(null)
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1704064)
                        .stockNumber(10821107)
                        .handlingUnitNumber("4000045856")
                        .location("001BC0044400")
                        .itemNumber("102494")
                        .serialNumber(null)
                        .batch1("FFQA")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(3.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("12:14:31")
                        .user("HS")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1703750)
                        .stockNumber(10821107)
                        .handlingUnitNumber("4000045856")
                        .location("001AK0100000")
                        .itemNumber("102494")
                        .serialNumber(null)
                        .batch1("FFQA")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(3.00))
                        .quantityTotal(BigDecimal.valueOf(3.00))
                        .weightChange(BigDecimal.valueOf(0.99))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_IN)
                        .statusCode(25)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("11:08:42")
                        .user("KAAC")
                        .printIndicator("N")
                        .document1("ELU0003056")
                        .document2("2")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build()
        );

        StockData stockData = new StockData(new ArrayList<>());
        movementRecords.forEach(movement -> stockData.handleMovement(Result.success(movement)));
        stockData.cleanUp();
        assertThat(stockData.getStockRecord(10821107)).isNull();
    }

    @Test
    void testBulkWarehouseTransferMovements() {
        List<MovementRecord> movementRecords = List.of(
                MovementRecord.builder()
                        .sequenceNumber(299738)
                        .stockNumber(101585)
                        .handlingUnitNumber("7000015227")
                        .location("001WA0000000")
                        .itemNumber("103061")
                        .serialNumber(null)
                        .batch1("611235")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(12.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(28)
                        .date(LocalDate.parse("2024-03-22"))
                        .time("09:11:28")
                        .user("MaAn")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber("AT0009766")
                        .customerOrderPosition("40000")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(267746)
                        .stockNumber(101585)
                        .handlingUnitNumber("7000015227")
                        .location("001WA0000000")
                        .itemNumber("103061")
                        .serialNumber(null)
                        .batch1("611235")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(12.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2024-03-01"))
                        .time("08:08:25")
                        .user("MoMo")
                        .printIndicator("N")
                        .document1("PZ0010092")
                        .document2(null)
                        .customerOrderNumber("AT0009766")
                        .customerOrderPosition("40000")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(267745)
                        .stockNumber(101585)
                        .handlingUnitNumber("7000015227")
                        .location("001PP0100000")
                        .itemNumber("103061")
                        .serialNumber(null)
                        .batch1("611235")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(12.00))
                        .quantityTotal(BigDecimal.valueOf(12.00))
                        .weightChange(BigDecimal.valueOf(5.04))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_IN)
                        .statusCode(26)
                        .date(LocalDate.parse("2024-03-01"))
                        .time("08:08:19")
                        .user("MoMo")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber("AT0009766")
                        .customerOrderPosition("40000")
                        .build()
        );

        StockRecord stockRecord = StockRecord.builder()
                .sequenceNumber(101585)
                .itemNumber("103061")
                .client(250)
                .batch1("611235")
                .batch2("____________________")
                .serialNumber(null)
                .customerOrderNumber("AT0009766")
                .customerOrderPosition("40000")
                .palletNumber("7000015227")
                .handlingUnitNumber("7000015227")
                .location("001WA0000000")
                .quantityOnHand(BigDecimal.valueOf(12.00))
                .build();

        StockData stockData = new StockData(List.of(stockRecord));
        movementRecords.forEach(movement -> stockData.handleMovement(Result.success(movement)));
        stockData.cleanUp();
        assertThat(stockData.getStockRecord(101585)).isNull();
        assertThat(stockData.getErrors()).isEmpty();
    }

    @Test
    void testBulkInventoryMovements() {
        List<MovementRecord> movementRecords = List.of(
                MovementRecord.builder()
                        .sequenceNumber(1707018)
                        .stockNumber(10829822)
                        .handlingUnitNumber("9000047190")
                        .location("001AK0000000")
                        .itemNumber("101190")
                        .serialNumber(null)
                        .batch1("153748")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(9.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(14)
                        .date(LocalDate.parse("2026-02-18"))
                        .time("13:14:50")
                        .user("PiDu")
                        .printIndicator("N")
                        .document1("AKL Inventur")
                        .document2("Abschluss")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("____")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1707017)
                        .stockNumber(10829822)
                        .handlingUnitNumber("9000047190")
                        .location("001AK9900000")
                        .itemNumber("101190")
                        .serialNumber(null)
                        .batch1("153748")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(9.00))
                        .quantityTotal(BigDecimal.valueOf(9.00))
                        .weightChange(BigDecimal.valueOf(1.71))
                        .client(250)
                        .event(MovementEvent.BATCH_CORRECTION_IN)
                        .statusCode(60)
                        .date(LocalDate.parse("2026-02-18"))
                        .time("13:14:35")
                        .user("PiDu")
                        .printIndicator("N")
                        .document1("Charge")
                        .document2("-")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("____")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1707016)
                        .stockNumber(10829822)
                        .handlingUnitNumber("9000047190")
                        .location("001AK9900000")
                        .itemNumber("101190")
                        .serialNumber(null)
                        .batch1("153748;25L1069")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(-9.00))
                        .quantityTotal(BigDecimal.valueOf(9.00))
                        .weightChange(BigDecimal.valueOf(-1.71))
                        .client(250)
                        .event(MovementEvent.BATCH_CORRECTION_OUT)
                        .statusCode(60)
                        .date(LocalDate.parse("2026-02-18"))
                        .time("13:14:35")
                        .user("PiDu")
                        .printIndicator("N")
                        .document1("Charge")
                        .document2("-")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("____")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1707003)
                        .stockNumber(10829822)
                        .handlingUnitNumber("9000047190")
                        .location("001AK9900000")
                        .itemNumber("101190")
                        .serialNumber(null)
                        .batch1("153748;25L1069")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(9.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(14)
                        .date(LocalDate.parse("2026-02-18"))
                        .time("13:04:15")
                        .user("PiDu")
                        .printIndicator("N")
                        .document1("AKL-Inventur")
                        .document2("Auslagerung")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("____")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1704511)
                        .stockNumber(10829822)
                        .handlingUnitNumber("9000047190")
                        .location("001AK0000000")
                        .itemNumber("101190")
                        .serialNumber(null)
                        .batch1("153748;25L1069")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(9.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(10)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("13:51:44")
                        .user("ToLa")
                        .printIndicator("N")
                        .document1(null)
                        .document2("001WE0000000")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("____")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(1704510)
                        .stockNumber(10829822)
                        .handlingUnitNumber("9000047190")
                        .location("001BC0001700")
                        .itemNumber("101190")
                        .serialNumber(null)
                        .batch1("153748;25L1069")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(9.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2026-02-17"))
                        .time("13:51:39")
                        .user("ToLa")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("____")
                        .build()
        );

        StockRecord stockRecord = StockRecord.builder()
                .sequenceNumber(10829822)
                .itemNumber("101190")
                .client(250)
                .batch1("153748")
                .batch2("____________________")
                .serialNumber(null)
                .customerOrderNumber("____________________")
                .customerOrderPosition("__________")
                .palletNumber("9000047190")
                .handlingUnitNumber("9000047190")
                .location("001BC0001700")
                .quantityOnHand(BigDecimal.valueOf(9.00))
                .build();

        StockData stockData = new StockData(List.of(stockRecord));
        movementRecords.forEach(movement -> stockData.handleMovement(Result.success(movement)));
        stockData.cleanUp();
        assertNotNull(stockData.getStockRecord(10829822));
        assertThat(stockData.getStockRecord(10829822).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(9.00));
        assertThat(stockData.getStockRecord(10829822).getHandlingUnitNumber()).isEqualTo("9000047190");
        assertThat(stockData.getStockRecord(10829822).getPalletNumber()).isEqualTo("9000047190");
        assertThat(stockData.getStockRecord(10829822).getLocation()).isEqualTo("001BC0001700");
    }

    @Test
    void testBulkBatchCorrectionMovements() {
        List<MovementRecord> movementRecords = List.of(
                MovementRecord.builder()
                        .sequenceNumber(271074)
                        .stockNumber(101701)
                        .handlingUnitNumber("7000015248")
                        .location("001WA0000000")
                        .itemNumber("101288")
                        .serialNumber(null)
                        .batch1("104373")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(20.00))
                        .quantityTotal(BigDecimal.valueOf(20.00))
                        .weightChange(BigDecimal.valueOf(13.40))
                        .client(250)
                        .event(MovementEvent.BATCH_CORRECTION_IN)
                        .statusCode(60)
                        .date(LocalDate.parse("2024-03-05"))
                        .time("08:00:43")
                        .user("ZoLa")
                        .printIndicator("N")
                        .document1("Chargenkorrektur")
                        .document2("-")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(271073)
                        .stockNumber(101701)
                        .handlingUnitNumber("7000015248")
                        .location("001WA0000000")
                        .itemNumber("101288")
                        .serialNumber(null)
                        .batch1("4373")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(-20.00))
                        .quantityTotal(BigDecimal.valueOf(20.00))
                        .weightChange(BigDecimal.valueOf(-13.40))
                        .client(250)
                        .event(MovementEvent.BATCH_CORRECTION_OUT)
                        .statusCode(60)
                        .date(LocalDate.parse("2024-03-05"))
                        .time("08:00:43")
                        .user("ZoLa")
                        .printIndicator("N")
                        .document1("Chargenkorrektur")
                        .document2("-")
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(268109)
                        .stockNumber(101701)
                        .handlingUnitNumber("7000015248")
                        .location("001WA0000000")
                        .itemNumber("101288")
                        .serialNumber(null)
                        .batch1("4373")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(20.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(28)
                        .date(LocalDate.parse("2024-03-01"))
                        .time("09:40:11")
                        .user("MaAn")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(268101)
                        .stockNumber(101701)
                        .handlingUnitNumber("7000015248")
                        .location("001WA0000000")
                        .itemNumber("101288")
                        .serialNumber(null)
                        .batch1("4373")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(0.00))
                        .quantityTotal(BigDecimal.valueOf(20.00))
                        .weightChange(BigDecimal.valueOf(0.00))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_NEUTRAL)
                        .statusCode(11)
                        .date(LocalDate.parse("2024-03-01"))
                        .time("09:36:18")
                        .user("MaAn")
                        .printIndicator("N")
                        .document1("PZ0010045")
                        .document2(null)
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build(),
                MovementRecord.builder()
                        .sequenceNumber(268097)
                        .stockNumber(101701)
                        .handlingUnitNumber("7000015248")
                        .location("001PP0100000")
                        .itemNumber("101288")
                        .serialNumber(null)
                        .batch1("4373")
                        .batch2("____________________")
                        .quantityChange(BigDecimal.valueOf(20.00))
                        .quantityTotal(BigDecimal.valueOf(20.00))
                        .weightChange(BigDecimal.valueOf(13.40))
                        .client(250)
                        .event(MovementEvent.MOVEMENT_IN)
                        .statusCode(26)
                        .date(LocalDate.parse("2024-03-01"))
                        .time("09:36:09")
                        .user("MaAn")
                        .printIndicator("N")
                        .document1(null)
                        .document2(null)
                        .customerOrderNumber("____________________")
                        .customerOrderPosition("__________")
                        .build()
        );

        StockData stockData = new StockData(new ArrayList<>());
        stockData.handleMovement(Result.success(movementRecords.get(0)));
        assertThat(stockData.getStockRecord(101701)).isNotNull();
        assertThat(stockData.getStockRecord(101701).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(0.00));
        assertThat(stockData.getStockRecord(101701).getHandlingUnitNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getPalletNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getLocation()).isEqualTo("001WA0000000");

        stockData.handleMovement(Result.success(movementRecords.get(1)));
        assertThat(stockData.getStockRecord(101701)).isNotNull();
        assertThat(stockData.getStockRecord(101701).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(20.00));
        assertThat(stockData.getStockRecord(101701).getHandlingUnitNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getPalletNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getLocation()).isEqualTo("001WA0000000");

        stockData.handleMovement(Result.success(movementRecords.get(2)));
        assertThat(stockData.getStockRecord(101701)).isNotNull();
        assertThat(stockData.getStockRecord(101701).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(20.00));
        assertThat(stockData.getStockRecord(101701).getHandlingUnitNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getPalletNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getLocation()).isEqualTo("001WA0000000");
        stockData.handleMovement(Result.success(movementRecords.get(3)));
        assertThat(stockData.getStockRecord(101701)).isNotNull();
        assertThat(stockData.getStockRecord(101701).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(20.00));
        assertThat(stockData.getStockRecord(101701).getHandlingUnitNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getPalletNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getLocation()).isEqualTo("001WA0000000");
        stockData.handleMovement(Result.success(movementRecords.get(4)));
        assertThat(stockData.getStockRecord(101701)).isNotNull();
        assertThat(stockData.getStockRecord(101701).getQuantityOnHand()).isEqualByComparingTo(BigDecimal.valueOf(0.00));
        assertThat(stockData.getStockRecord(101701).getHandlingUnitNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getPalletNumber()).isEqualTo("7000015248");
        assertThat(stockData.getStockRecord(101701).getLocation()).isEqualTo("001PP0100000");

    }
}
